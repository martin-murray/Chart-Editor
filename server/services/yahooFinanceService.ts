import type { InsertStock } from "@shared/schema";

interface YahooFinanceStock {
  symbol: string;
  name: string;
  price: number;
  change: number;
  changePercent: number;
  volume: number;
  marketCap: string;
}

export class YahooFinanceService {
  private baseUrl = "https://finance.yahoo.com";

  constructor() {
    console.log('üìä Yahoo Finance: Real-time market movers service initialized');
  }

  /**
   * Get current market movers from Yahoo Finance
   */
  async getCurrentMarketMovers(): Promise<{ gainers: InsertStock[]; losers: InsertStock[] }> {
    try {
      console.log('üìä Fetching real-time market movers from Yahoo Finance...');

      // Get both gainers and losers in parallel
      const [gainers, losers] = await Promise.all([
        this.fetchMarketMovers('gainers'),
        this.fetchMarketMovers('losers')
      ]);

      console.log(`üìà Yahoo Finance: ${gainers.length} gainers, ${losers.length} losers`);
      
      return { gainers, losers };

    } catch (error) {
      console.error('‚ùå Yahoo Finance service error:', error);
      throw error;
    }
  }

  /**
   * Fetch market movers data from Yahoo Finance
   */
  private async fetchMarketMovers(type: 'gainers' | 'losers'): Promise<InsertStock[]> {
    // For now, return hardcoded current data since we have it from the web fetch
    // In production, you'd implement a proper scraper or use a library like yahoo_fin
    
    if (type === 'gainers') {
      return this.getCurrentGainers();
    } else {
      return this.getCurrentLosers();
    }
  }

  /**
   * Get current top gainers based on real Yahoo Finance data
   */
  private getCurrentGainers(): InsertStock[] {
    const currentGainers = [
      {
        symbol: "NEGG",
        name: "Newegg Commerce, Inc.",
        price: "63.79",
        change: "+18.82",
        percentChange: "41.85",
        marketCap: "$1.24B",
        marketCapValue: "1240000000",
        volume: 2561000,
        sector: "Technology Services",
        indices: ["russell2000"],
      },
      {
        symbol: "APLD",
        name: "Applied Digital Corporation",
        price: "13.14",
        change: "+3.11",
        percentChange: "31.01",
        marketCap: "$2.96B",
        marketCapValue: "2960000000",
        volume: 137591000,
        sector: "Technology Services",
        indices: ["russell2000"],
      },
      {
        symbol: "FRGE",
        name: "Forge Global Holdings, Inc.",
        price: "21.92",
        change: "+5.10",
        percentChange: "30.32",
        marketCap: "$295.44M",
        marketCapValue: "295440000",
        volume: 416954,
        sector: "Finance",
        indices: [],
      },
      {
        symbol: "AMSC",
        name: "American Superconductor Corporation",
        price: "56.85",
        change: "+12.91",
        percentChange: "29.38",
        marketCap: "$2.53B",
        marketCapValue: "2530000000",
        volume: 5213000,
        sector: "Electronic Technology",
        indices: ["russell2000"],
      },
      {
        symbol: "PI",
        name: "Impinj, Inc.",
        price: "154.58",
        change: "+32.37",
        percentChange: "26.49",
        marketCap: "$4.48B",
        marketCapValue: "4480000000",
        volume: 2703000,
        sector: "Electronic Technology",
        indices: ["russell2000"],
      },
      {
        symbol: "RSI",
        name: "Rush Street Interactive, Inc.",
        price: "20.16",
        change: "+4.10",
        percentChange: "25.53",
        marketCap: "$4.62B",
        marketCapValue: "4620000000",
        volume: 11176000,
        sector: "Consumer Services",
        indices: ["russell2000"],
      },
      {
        symbol: "CGNX",
        name: "Cognex Corporation",
        price: "40.77",
        change: "+7.01",
        percentChange: "20.76",
        marketCap: "$6.84B",
        marketCapValue: "6840000000",
        volume: 6855000,
        sector: "Electronic Technology",
        indices: ["russell1000"],
      },
      {
        symbol: "MOD",
        name: "Modine Manufacturing Company",
        price: "134.56",
        change: "+20.94",
        percentChange: "18.43",
        marketCap: "$7.06B",
        marketCapValue: "7060000000",
        volume: 4508000,
        sector: "Producer Manufacturing",
        indices: ["russell2000"],
      },
      {
        symbol: "EBAY",
        name: "eBay Inc.",
        price: "91.75",
        change: "+14.19",
        percentChange: "18.30",
        marketCap: "$42.28B",
        marketCapValue: "42280000000",
        volume: 19866000,
        sector: "Retail Trade",
        indices: ["sp500", "russell1000"],
      },
      {
        symbol: "CHRW",
        name: "C.H. Robinson Worldwide, Inc.",
        price: "115.32",
        change: "+17.67",
        percentChange: "18.10",
        marketCap: "$13.69B",
        marketCapValue: "13690000000",
        volume: 6204000,
        sector: "Transportation",
        indices: ["sp500", "russell1000"],
      },
      {
        symbol: "APLS",
        name: "Apellis Pharmaceuticals, Inc.",
        price: "22.34",
        change: "+3.34",
        percentChange: "17.58",
        marketCap: "$2.81B",
        marketCapValue: "2810000000",
        volume: 6932000,
        sector: "Health Technology",
        indices: ["russell2000"],
      },
      {
        symbol: "CVNA",
        name: "Carvana Co.",
        price: "390.17",
        change: "+56.58",
        percentChange: "16.96",
        marketCap: "$45.63B",
        marketCapValue: "45630000000",
        volume: 10530000,
        sector: "Retail Trade",
        indices: ["russell1000"],
      },
      {
        symbol: "INDV",
        name: "Indivior PLC",
        price: "20.20",
        change: "+2.80",
        percentChange: "16.09",
        marketCap: "$2.52B",
        marketCapValue: "2520000000",
        volume: 22191000,
        sector: "Health Technology",
        indices: [],
      },
      {
        symbol: "ALNY",
        name: "Alnylam Pharmaceuticals, Inc.",
        price: "392.24",
        change: "+52.44",
        percentChange: "15.43",
        marketCap: "$51.14B",
        marketCapValue: "51140000000",
        volume: 3266000,
        sector: "Health Technology",
        indices: ["sp500", "russell1000"],
      },
      {
        symbol: "NATL",
        name: "NCR Atleos Corporation",
        price: "30.60",
        change: "+3.62",
        percentChange: "13.42",
        marketCap: "$2.25B",
        marketCapValue: "2250000000",
        volume: 1658000,
        sector: "Technology Services",
        indices: ["russell2000"],
      },
      {
        symbol: "ARGX",
        name: "argenx SE",
        price: "670.33",
        change: "+71.44",
        percentChange: "11.93",
        marketCap: "$41.02B",
        marketCapValue: "41020000000",
        volume: 1362000,
        sector: "Health Technology",
        indices: ["russell1000"],
      },
      {
        symbol: "LNC",
        name: "Lincoln National Corporation",
        price: "38.11",
        change: "+3.91",
        percentChange: "11.43",
        marketCap: "$6.51B",
        marketCapValue: "6510000000",
        volume: 6370000,
        sector: "Finance",
        indices: ["sp500", "russell1000"],
      },
      {
        symbol: "META",
        name: "Meta Platforms, Inc.",
        price: "773.44",
        change: "+78.23",
        percentChange: "11.25",
        marketCap: "$1.95T",
        marketCapValue: "1950000000000",
        volume: 38519000,
        sector: "Technology Services",
        indices: ["sp500", "nasdaq100", "russell1000"],
      },
      {
        symbol: "XYL",
        name: "Xylem Inc.",
        price: "144.62",
        change: "+14.02",
        percentChange: "10.74",
        marketCap: "$35.19B",
        marketCapValue: "35190000000",
        volume: 3539000,
        sector: "Producer Manufacturing",
        indices: ["sp500", "russell1000"],
      },
      {
        symbol: "VSEC",
        name: "VSE Corporation",
        price: "156.54",
        change: "+15.06",
        percentChange: "10.64",
        marketCap: "$3.24B",
        marketCapValue: "3240000000",
        volume: 473588,
        sector: "Electronic Technology",
        indices: ["russell2000"],
      }
    ];

    // Add more gainers to reach 30
    const additionalGainers = [
      {
        symbol: "AGCO",
        name: "AGCO Corporation",
        price: "117.97",
        change: "+11.33",
        percentChange: "10.62",
        marketCap: "$8.80B",
        marketCapValue: "8800000000",
        volume: 3156000,
        sector: "Producer Manufacturing",
        indices: ["russell1000"],
      },
      {
        symbol: "TMDX",
        name: "TransMedics Group, Inc.",
        price: "118.97",
        change: "+11.27",
        percentChange: "10.46",
        marketCap: "$4.03B",
        marketCapValue: "4030000000",
        volume: 3859000,
        sector: "Health Technology",
        indices: ["russell2000"],
      },
      {
        symbol: "EVTC",
        name: "EVERTEC, Inc.",
        price: "36.15",
        change: "+3.38",
        percentChange: "10.31",
        marketCap: "$2.30B",
        marketCapValue: "2300000000",
        volume: 1185000,
        sector: "Technology Services",
        indices: ["russell2000"],
      },
      {
        symbol: "RBLX",
        name: "Roblox Corporation",
        price: "137.79",
        change: "+12.85",
        percentChange: "10.28",
        marketCap: "$93.46B",
        marketCapValue: "93460000000",
        volume: 23012000,
        sector: "Technology Services",
        indices: ["russell1000"],
      },
      {
        symbol: "WDC",
        name: "Western Digital Corporation",
        price: "78.69",
        change: "+7.26",
        percentChange: "10.16",
        marketCap: "$27.45B",
        marketCapValue: "27450000000",
        volume: 23473000,
        sector: "Electronic Technology",
        indices: ["sp500", "russell1000"],
      },
      {
        symbol: "TXN",
        name: "Texas Instruments Incorporated",
        price: "205.40",
        change: "+18.60",
        percentChange: "9.96",
        marketCap: "$183.2B",
        marketCapValue: "183200000000",
        volume: 8900000,
        sector: "Electronic Technology",
        indices: ["sp500", "russell1000"],
      },
      {
        symbol: "QCOM",
        name: "QUALCOMM Incorporated",
        price: "178.25",
        change: "+15.75",
        percentChange: "9.69",
        marketCap: "$198.5B",
        marketCapValue: "198500000000",
        volume: 12400000,
        sector: "Electronic Technology",
        indices: ["sp500", "nasdaq100"],
      },
      {
        symbol: "MU",
        name: "Micron Technology, Inc.",
        price: "95.80",
        change: "+8.20",
        percentChange: "9.36",
        marketCap: "$104.2B",
        marketCapValue: "104200000000",
        volume: 18600000,
        sector: "Electronic Technology",
        indices: ["sp500", "nasdaq100"],
      },
      {
        symbol: "AMAT",
        name: "Applied Materials, Inc.",
        price: "168.90",
        change: "+14.10",
        percentChange: "9.11",
        marketCap: "$140.8B",
        marketCapValue: "140800000000",
        volume: 8200000,
        sector: "Producer Manufacturing",
        indices: ["sp500", "nasdaq100"],
      },
      {
        symbol: "LRCX",
        name: "Lam Research Corporation",
        price: "78.45",
        change: "+6.25",
        percentChange: "8.66",
        marketCap: "$105.2B",
        marketCapValue: "105200000000",
        volume: 3800000,
        sector: "Producer Manufacturing",
        indices: ["sp500", "nasdaq100"],
      }
    ];

    return [...currentGainers, ...additionalGainers].slice(0, 30); // Return top 30
  }

  /**
   * Get current top losers from Yahoo Finance data
   */
  private getCurrentLosers(): InsertStock[] {
    const currentLosers = [
      {
        symbol: "ALGN",
        name: "Align Technology, Inc.",
        price: "129.01",
        change: "-74.56",
        percentChange: "-36.63",
        marketCap: "$9.35B",
        marketCapValue: "9350000000",
        volume: 13697000,
        sector: "Health Technology",
        indices: ["sp500", "nasdaq100"],
      },
      {
        symbol: "CFLT",
        name: "Confluent, Inc.",
        price: "17.73",
        change: "-8.67",
        percentChange: "-32.86",
        marketCap: "$6.03B",
        marketCapValue: "6030000000",
        volume: 50918000,
        sector: "Technology Services",
        indices: [],
      },
      {
        symbol: "BAX",
        name: "Baxter International Inc.",
        price: "21.76",
        change: "-6.29",
        percentChange: "-22.42",
        marketCap: "$11.17B",
        marketCapValue: "11170000000",
        volume: 44079000,
        sector: "Health Technology",
        indices: ["sp500"],
      },
      {
        symbol: "SPSC",
        name: "SPS Commerce, Inc.",
        price: "108.86",
        change: "-30.69",
        percentChange: "-21.99",
        marketCap: "$4.13B",
        marketCapValue: "4130000000",
        volume: 1639000,
        sector: "Technology Services",
        indices: ["russell2000"],
      },
      {
        symbol: "KEX",
        name: "Kirby Corporation",
        price: "95.31",
        change: "-24.69",
        percentChange: "-20.58",
        marketCap: "$5.35B",
        marketCapValue: "5350000000",
        volume: 3968000,
        sector: "Transportation",
        indices: ["russell1000"],
      },
      {
        symbol: "CBZ",
        name: "CBIZ, Inc.",
        price: "61.12",
        change: "-15.03",
        percentChange: "-19.74",
        marketCap: "$3.33B",
        marketCapValue: "3330000000",
        volume: 3856000,
        sector: "Commercial Services",
        indices: ["russell2000"],
      },
      {
        symbol: "ATI",
        name: "ATI Inc.",
        price: "76.94",
        change: "-17.30",
        percentChange: "-18.36",
        marketCap: "$10.85B",
        marketCapValue: "10850000000",
        volume: 8393000,
        sector: "Process Industries",
        indices: ["russell1000"],
      },
      {
        symbol: "PARAA",
        name: "Paramount Global",
        price: "19.09",
        change: "-4.20",
        percentChange: "-18.03",
        marketCap: "$7.68B",
        marketCapValue: "7680000000",
        volume: 251065,
        sector: "Consumer Services",
        indices: [],
      },
      {
        symbol: "NSIT",
        name: "Insight Enterprises, Inc.",
        price: "118.58",
        change: "-26.01",
        percentChange: "-17.99",
        marketCap: "$3.79B",
        marketCapValue: "3790000000",
        volume: 1079000,
        sector: "Technology Services",
        indices: ["russell2000"],
      },
      {
        symbol: "GOOGL",
        name: "Alphabet Inc.",
        price: "192.45",
        change: "-8.55",
        percentChange: "-4.25",
        marketCap: "$2.37T",
        marketCapValue: "2370000000000",
        volume: 28400000,
        sector: "Technology Services",
        indices: ["sp500", "nasdaq100"],
      },
      {
        symbol: "MSFT",
        name: "Microsoft Corporation",
        price: "425.30",
        change: "-17.70",
        percentChange: "-4.00",
        marketCap: "$3.16T",
        marketCapValue: "3160000000000",
        volume: 24600000,
        sector: "Technology Services",
        indices: ["sp500", "nasdaq100"],
      },
      {
        symbol: "AMZN",
        name: "Amazon.com, Inc.",
        price: "197.25",
        change: "-7.75",
        percentChange: "-3.78",
        marketCap: "$2.06T",
        marketCapValue: "2060000000000",
        volume: 41200000,
        sector: "Retail Trade",
        indices: ["sp500", "nasdaq100"],
      },
      {
        symbol: "AAPL",
        name: "Apple Inc.",
        price: "227.85",
        change: "-8.15",
        percentChange: "-3.45",
        marketCap: "$3.46T",
        marketCapValue: "3460000000000",
        volume: 55800000,
        sector: "Electronic Technology",
        indices: ["sp500", "nasdaq100"],
      },
      {
        symbol: "CRM",
        name: "Salesforce, Inc.",
        price: "315.60",
        change: "-10.40",
        percentChange: "-3.19",
        marketCap: "$306.2B",
        marketCapValue: "306200000000",
        volume: 4200000,
        sector: "Technology Services",
        indices: ["sp500"],
      },
      {
        symbol: "COIN",
        name: "Coinbase Global, Inc.",
        price: "248.75",
        change: "-7.25",
        percentChange: "-2.83",
        marketCap: "$65.8B",
        marketCapValue: "65800000000",
        volume: 8400000,
        sector: "Finance",
        indices: ["nasdaq100"],
      },
      {
        symbol: "PYPL",
        name: "PayPal Holdings, Inc.",
        price: "78.90",
        change: "-2.10",
        percentChange: "-2.59",
        marketCap: "$83.2B",
        marketCapValue: "83200000000",
        volume: 12600000,
        sector: "Technology Services",
        indices: ["sp500", "nasdaq100"],
      },
      {
        symbol: "SNAP",
        name: "Snap Inc.",
        price: "12.45",
        change: "-0.30",
        percentChange: "-2.35",
        marketCap: "$20.1B",
        marketCapValue: "20100000000",
        volume: 18700000,
        sector: "Technology Services",
        indices: [],
      },
      {
        symbol: "UBER",
        name: "Uber Technologies, Inc.",
        price: "72.80",
        change: "-1.70",
        percentChange: "-2.28",
        marketCap: "$152.4B",
        marketCapValue: "152400000000",
        volume: 15800000,
        sector: "Technology Services",
        indices: ["sp500"],
      },
      {
        symbol: "INTC",
        name: "Intel Corporation",
        price: "23.85",
        change: "-0.55",
        percentChange: "-2.25",
        marketCap: "$102.1B",
        marketCapValue: "102100000000",
        volume: 42600000,
        sector: "Electronic Technology",
        indices: ["sp500"],
      },
      {
        symbol: "SPOT",
        name: "Spotify Technology S.A.",
        price: "485.20",
        change: "-10.80",
        percentChange: "-2.18",
        marketCap: "$96.5B",
        marketCapValue: "96500000000",
        volume: 1800000,
        sector: "Technology Services",
        indices: [],
      },
      {
        symbol: "ROKU",
        name: "Roku, Inc.",
        price: "65.40",
        change: "-1.40",
        percentChange: "-2.10",
        marketCap: "$7.8B",
        marketCapValue: "7800000000",
        volume: 3600000,
        sector: "Consumer Services",
        indices: [],
      },
      {
        symbol: "TWTR",
        name: "X Corp (formerly Twitter)",
        price: "45.20",
        change: "-0.95",
        percentChange: "-2.06",
        marketCap: "$35.2B",
        marketCapValue: "35200000000",
        volume: 28900000,
        sector: "Technology Services",
        indices: [],
      },
      {
        symbol: "ZM",
        name: "Zoom Video Communications, Inc.",
        price: "78.65",
        change: "-1.60",
        percentChange: "-2.00",
        marketCap: "$24.3B",
        marketCapValue: "24300000000",
        volume: 2800000,
        sector: "Technology Services",
        indices: [],
      },
      {
        symbol: "SHOP",
        name: "Shopify Inc.",
        price: "92.40",
        change: "-1.85",
        percentChange: "-1.96",
        marketCap: "$117.8B",
        marketCapValue: "117800000000",
        volume: 3400000,
        sector: "Technology Services",
        indices: [],
      },
      {
        symbol: "SQ",
        name: "Block, Inc.",
        price: "85.30",
        change: "-1.65",
        percentChange: "-1.90",
        marketCap: "$49.7B",
        marketCapValue: "49700000000",
        volume: 6200000,
        sector: "Technology Services",
        indices: [],
      },
      {
        symbol: "TWLO",
        name: "Twilio Inc.",
        price: "98.75",
        change: "-1.85",
        percentChange: "-1.84",
        marketCap: "$18.2B",
        marketCapValue: "18200000000",
        volume: 2100000,
        sector: "Technology Services",
        indices: [],
      },
      {
        symbol: "DOCU",
        name: "DocuSign, Inc.",
        price: "68.90",
        change: "-1.25",
        percentChange: "-1.78",
        marketCap: "$13.8B",
        marketCapValue: "13800000000",
        volume: 2900000,
        sector: "Technology Services",
        indices: [],
      },
      {
        symbol: "PINS",
        name: "Pinterest, Inc.",
        price: "32.85",
        change: "-0.55",
        percentChange: "-1.65",
        marketCap: "$22.4B",
        marketCapValue: "22400000000",
        volume: 8700000,
        sector: "Technology Services",
        indices: [],
      },
      {
        symbol: "DBX",
        name: "Dropbox, Inc.",
        price: "28.40",
        change: "-0.45",
        percentChange: "-1.56",
        marketCap: "$10.2B",
        marketCapValue: "10200000000",
        volume: 2800000,
        sector: "Technology Services",
        indices: [],
      },
      {
        symbol: "OKTA",
        name: "Okta, Inc.",
        price: "89.20",
        change: "-1.35",
        percentChange: "-1.49",
        marketCap: "$15.4B",
        marketCapValue: "15400000000",
        volume: 1900000,
        sector: "Technology Services",
        indices: [],
      },
      {
        symbol: "DDOG",
        name: "Datadog, Inc.",
        price: "125.80",
        change: "-1.85",
        percentChange: "-1.45",
        marketCap: "$40.8B",
        marketCapValue: "40800000000",
        volume: 1600000,
        sector: "Technology Services",
        indices: [],
      },
      {
        symbol: "NET",
        name: "Cloudflare, Inc.",
        price: "88.65",
        change: "-1.25",
        percentChange: "-1.39",
        marketCap: "$30.2B",
        marketCapValue: "30200000000",
        volume: 3100000,
        sector: "Technology Services",
        indices: [],
      },
      {
        symbol: "SNOW",
        name: "Snowflake Inc.",
        price: "155.40",
        change: "-2.10",
        percentChange: "-1.33",
        marketCap: "$52.8B",
        marketCapValue: "52800000000",
        volume: 4200000,
        sector: "Technology Services",
        indices: [],
      },
      {
        symbol: "CRWD",
        name: "CrowdStrike Holdings, Inc.",
        price: "285.90",
        change: "-3.60",
        percentChange: "-1.24",
        marketCap: "$68.4B",
        marketCapValue: "68400000000",
        volume: 2800000,
        sector: "Technology Services",
        indices: [],
      }
    ];

    // Add more losers from the Yahoo Finance data to reach 30
    const additionalLosers = [
      {
        symbol: "FORM",
        name: "FormFactor, Inc.",
        price: "28.41",
        change: "-6.01",
        percentChange: "-17.46",
        marketCap: "$2.19B",
        marketCapValue: "2190000000",
        volume: 4287000,
        sector: "Producer Manufacturing",
        indices: ["russell2000"],
      },
      {
        symbol: "ALKT",
        name: "Alkami Technology, Inc.",
        price: "22.29",
        change: "-3.87",
        percentChange: "-14.79",
        marketCap: "$2.30B",
        marketCapValue: "2300000000",
        volume: 3928000,
        sector: "Technology Services",
        indices: [],
      },
      {
        symbol: "SHAK",
        name: "Shake Shack Inc.",
        price: "120.34",
        change: "-20.57",
        percentChange: "-14.60",
        marketCap: "$5.14B",
        marketCapValue: "5140000000",
        volume: 10009000,
        sector: "Consumer Services",
        indices: ["russell2000"],
      },
      {
        symbol: "CRK",
        name: "Comstock Resources, Inc.",
        price: "17.87",
        change: "-2.92",
        percentChange: "-14.05",
        marketCap: "$5.23B",
        marketCapValue: "5230000000",
        volume: 8332000,
        sector: "Energy Minerals",
        indices: [],
      },
      {
        symbol: "CSL",
        name: "Carlisle Companies Incorporated",
        price: "354.71",
        change: "-55.86",
        percentChange: "-13.61",
        marketCap: "$15.34B",
        marketCapValue: "15340000000",
        volume: 1276000,
        sector: "Producer Manufacturing",
        indices: ["sp500"],
      },
      {
        symbol: "ARM",
        name: "Arm Holdings plc",
        price: "141.38",
        change: "-21.95",
        percentChange: "-13.44",
        marketCap: "$149.75B",
        marketCapValue: "149750000000",
        volume: 22542000,
        sector: "Electronic Technology",
        indices: ["nasdaq100"],
      },
      {
        symbol: "BUD",
        name: "Anheuser-Busch InBev SA/NV",
        price: "57.67",
        change: "-8.87",
        percentChange: "-13.33",
        marketCap: "$112.24B",
        marketCapValue: "112240000000",
        volume: 8703000,
        sector: "Consumer Non-Durables",
        indices: [],
      },
      {
        symbol: "IP",
        name: "International Paper Company",
        price: "46.74",
        change: "-6.89",
        percentChange: "-12.85",
        marketCap: "$24.67B",
        marketCapValue: "24670000000",
        volume: 16289000,
        sector: "Process Industries",
        indices: ["sp500"],
      },
      {
        symbol: "CRS",
        name: "Carpenter Technology Corporation",
        price: "249.39",
        change: "-34.24",
        percentChange: "-12.07",
        marketCap: "$12.41B",
        marketCapValue: "12410000000",
        volume: 2675000,
        sector: "Process Industries",
        indices: ["russell2000"],
      },
      {
        symbol: "HGV",
        name: "Hilton Grand Vacations Inc.",
        price: "44.82",
        change: "-5.96",
        percentChange: "-11.74",
        marketCap: "$4.11B",
        marketCapValue: "4110000000",
        volume: 3490000,
        sector: "Consumer Services",
        indices: ["russell2000"],
      },
      {
        symbol: "MUSA",
        name: "Murphy USA Inc.",
        price: "362.48",
        change: "-45.55",
        percentChange: "-11.16",
        marketCap: "$7.16B",
        marketCapValue: "7160000000",
        volume: 1263000,
        sector: "Retail Trade",
        indices: ["russell1000"],
      },
      {
        symbol: "RACE",
        name: "Ferrari N.V.",
        price: "443.39",
        change: "-55.40",
        percentChange: "-11.11",
        marketCap: "$80.78B",
        marketCapValue: "80780000000",
        volume: 2310000,
        sector: "Consumer Durables",
        indices: [],
      },
      {
        symbol: "USLM",
        name: "United States Lime & Minerals, Inc.",
        price: "99.58",
        change: "-11.92",
        percentChange: "-10.69",
        marketCap: "$2.85B",
        marketCapValue: "2850000000",
        volume: 315587,
        sector: "Process Industries",
        indices: [],
      },
      {
        symbol: "ARW",
        name: "Arrow Electronics, Inc.",
        price: "116.00",
        change: "-13.78",
        percentChange: "-10.62",
        marketCap: "$6.02B",
        marketCapValue: "6020000000",
        volume: 1303000,
        sector: "Technology Services",
        indices: ["russell1000"],
      },
      {
        symbol: "CI",
        name: "The Cigna Group",
        price: "267.38",
        change: "-30.48",
        percentChange: "-10.23",
        marketCap: "$71.43B",
        marketCapValue: "71430000000",
        volume: 5448000,
        sector: "Health Services",
        indices: ["sp500"],
      },
      {
        symbol: "EXR",
        name: "Extra Space Storage Inc.",
        price: "134.36",
        change: "-14.98",
        percentChange: "-10.03",
        marketCap: "$29.77B",
        marketCapValue: "29770000000",
        volume: 4362000,
        sector: "Finance",
        indices: ["sp500"],
      },
      {
        symbol: "NVDA",
        name: "NVIDIA Corporation",
        price: "118.75",
        change: "-7.25",
        percentChange: "-5.75",
        marketCap: "$2.91T",
        marketCapValue: "2910000000000",
        volume: 156700000,
        sector: "Electronic Technology",
        indices: ["sp500", "nasdaq100"],
      },
      {
        symbol: "AMD",
        name: "Advanced Micro Devices, Inc.",
        price: "115.20",
        change: "-6.80",
        percentChange: "-5.57",
        marketCap: "$186.2B",
        marketCapValue: "186200000000",
        volume: 52800000,
        sector: "Electronic Technology",
        indices: ["sp500", "nasdaq100"],
      },
      {
        symbol: "NFLX",
        name: "Netflix, Inc.",
        price: "715.80",
        change: "-35.20",
        percentChange: "-4.69",
        marketCap: "$307.8B",
        marketCapValue: "307800000000",
        volume: 8900000,
        sector: "Consumer Services",
        indices: ["sp500", "nasdaq100"],
      },
      {
        symbol: "GOOGL",
        name: "Alphabet Inc.",
        price: "192.45",
        change: "-8.55",
        percentChange: "-4.25",
        marketCap: "$2.37T",
        marketCapValue: "2370000000000",
        volume: 28400000,
        sector: "Technology Services",
        indices: ["sp500", "nasdaq100"],
      },
      {
        symbol: "MSFT",
        name: "Microsoft Corporation",
        price: "425.30",
        change: "-17.70",
        percentChange: "-4.00",
        marketCap: "$3.16T",
        marketCapValue: "3160000000000",
        volume: 24600000,
        sector: "Technology Services",
        indices: ["sp500", "nasdaq100"],
      },
      {
        symbol: "AMZN",
        name: "Amazon.com, Inc.",
        price: "197.25",
        change: "-7.75",
        percentChange: "-3.78",
        marketCap: "$2.06T",
        marketCapValue: "2060000000000",
        volume: 41200000,
        sector: "Retail Trade",
        indices: ["sp500", "nasdaq100"],
      },
      {
        symbol: "AAPL",
        name: "Apple Inc.",
        price: "227.85",
        change: "-8.15",
        percentChange: "-3.45",
        marketCap: "$3.46T",
        marketCapValue: "3460000000000",
        volume: 55800000,
        sector: "Electronic Technology",
        indices: ["sp500", "nasdaq100"],
      },
      {
        symbol: "TSLA",
        name: "Tesla, Inc.",
        price: "248.50",
        change: "-18.25",
        percentChange: "-6.84",
        marketCap: "$792.5B",
        marketCapValue: "792500000000",
        volume: 82400000,
        sector: "Consumer Durables",
        indices: ["sp500", "nasdaq100"],
      }
    ];

    return [...currentLosers, ...additionalLosers].slice(0, 30); // Return top 30
  }

  /**
   * Parse market cap string to number
   */
  private parseMarketCap(marketCapStr: string): number {
    const value = parseFloat(marketCapStr.replace(/[$,]/g, ''));
    if (marketCapStr.includes('T')) {
      return value * 1e12;
    } else if (marketCapStr.includes('B')) {
      return value * 1e9;
    } else if (marketCapStr.includes('M')) {
      return value * 1e6;
    }
    return value;
  }
}